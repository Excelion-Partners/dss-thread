(this["webpackJsonpdss-thread"]=this["webpackJsonpdss-thread"]||[]).push([[0],{103:function(e,t,a){},104:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},105:function(e,t,a){},134:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),o=a(15),s=a.n(o),r=(a(103),a(31)),i=a(32),c=a(58),d=a(47),u=a(46),m=(a(104),a(105),a(48)),h=a(17),p=(a(106),a(79)),f={on:function(e,t){document.addEventListener(e,(function(e){return t(e.detail)}))},dispatch:function(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))},remove:function(e,t){document.removeEventListener(e,t)}},g=a(96),E=a(97),v=a(80),y=a(140),w=a(133),b=a(130),_=a(141),C=a(37),k=Object(n.memo)((function(e){var t,a,n=e.data,o=e.isConnectable;return l.a.createElement(l.a.Fragment,null,l.a.createElement(C.b,{type:"target",position:"left",style:{background:"#555"},isConnectable:o}),l.a.createElement("div",{style:{border:"solid 1px #333",borderRadius:"3px",textAlign:"center",padding:"10px"}},l.a.createElement("div",{style:{fontWeight:"bold"}},n.project),l.a.createElement("div",null,l.a.createElement("a",{href:(t=n.project,a=n.dataset,"/projects/"+t+"/datasets/"+a+"/explore/"),target:"_blank"},n.dataset)),l.a.createElement("div",null,n.column)),l.a.createElement(C.b,{type:"source",position:"right",isConnectable:o}))})),j=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).traverse=function(e,t,a){var l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=[];if(null!=t[a]&&t[a].length>0){l+=1;for(var s=0;s<t[a].length;s++)n.traverse(e,t[a][s],a,l)}else e[e.length]={count:l-1,name:t.name};return o},n.update=function(e,t){var a=[{id:"-1",data:{label:t.name},position:{x:250,y:140},style:{width:"200px",borderColor:"red",borderWidth:"2px",fontWeight:"bold"},sourcePosition:"right",targetPosition:"left",draggable:!1}],l=[];null!=t.lineage_downstream&&(null!=t.lineage_downstream_full?n.traverse(l,t,"lineage_downstream_full"):l=t.lineage_downstream);var o=[];null!=t.lineage_upstream&&(null!=t.lineage_upstream_full?n.traverse(o,t,"lineage_upstream_full"):o=t.lineage_upstream);for(var s=0;s<l.length;s++){null!=(u=l[s]).name&&(u=l[s].name);var r=(m=u.split("."))[0],i="",c="";m.length>1&&(i=m[1]),m.length>2&&(c=m[2]),a[a.length]={id:"down_"+s,type:"customFlowNode",data:{project:r,dataset:i,column:c},style:{width:"200px"},targetPosition:"left",sourcePosition:"right",position:{x:500,y:300/(l.length+1)*(s+1)},draggable:!1};var d={id:"-1-down_"+s,source:"-1",target:"down_"+s,arrowHeadType:"arrow"};l[s].count>0&&(d.label="["+l[s].count+"]",d.animated=!0),a[a.length]=d}for(s=0;s<o.length;s++){var u;null!=(u=o[s]).name&&(u=o[s].name);var m;r=(m=u.split("."))[0],i="",c="";m.length>1&&(i=m[1]),m.length>2&&(c=m[2]),a[a.length]={id:"up_"+s,type:"customFlowNode",data:{project:r,dataset:i,column:c},style:{width:"200px"},sourcePosition:"right",targetPosition:"left",position:{x:0,y:300/(o.length+1)*(s+1)},draggable:!1};d={id:"-1-up_"+s,source:"up_"+s,target:"-1",arrowHeadType:"arrow"};o[s].count>0&&(d.animated=!0,d.label="["+o[s].count+"]"),a[a.length]=d}var h={};h[e]=a,n.setState(h)},n.closeColumn=function(){n.modalClosed()},n.state={modalDialog:!1,selectedCol:{name:"",comment:""},elements:[],col_elements:[],last_ds:"",showA:!1},n.nodeTypes={customFlowNode:k},n}return Object(i.a)(a,[{key:"openColumn",value:function(e){this.update("col_elements",e),this.setState({modalDialog:!0,selectedCol:e})}},{key:"createColName",value:function(e){return this.props.full_ds_name+"."+e}},{key:"formatLineage",value:function(e){return null!=e?e.join(", "):""}},{key:"modalClosed",value:function(){this.update("elements",this.props.deets),this.setState({modalDialog:!1})}},{key:"saveColLineage",value:function(){for(var e=[this.createColName(this.state.selectedCol.name)],t=0;t<this.state.selectedCol.lineage_upstream.length;t++)e[e.length]=this.state.selectedCol.lineage_upstream[t];for(t=0;t<this.state.selectedCol.lineage_downstream.length;t++)e[e.length]=this.state.selectedCol.lineage_downstream[t];this.modalClosed(),fetch(window.getWebAppBackendUrl("update-col-desc"),{method:"POST",body:JSON.stringify({cols:e,desc:this.state.selectedCol.comment})}).then((function(e){return e.json()})).then((function(e){f.dispatch("dataRefresh",{})}))}},{key:"saveCol",value:function(){for(var e=0;e<this.props.deets.schema.columns.length;e++)if(this.props.deets.schema.columns[e].name==this.state.selectedCol.name){this.props.deets.schema.columns[e].comment=this.state.selectedCol.comment;break}this.modalClosed(),fetch(window.getWebAppBackendUrl("update-col-desc"),{method:"POST",body:JSON.stringify({cols:[this.createColName(this.state.selectedCol.name)],desc:this.state.selectedCol.comment,upstream:!1,downstream:!1})}).then((function(e){return e.json()})).then((function(e){f.dispatch("dataRefresh",{})}))}},{key:"createDsLink",value:function(e){return this.createDsLink2(e.projectKey,e.name)}},{key:"createDsLink2",value:function(e,t){return"/projects/"+e+"/datasets/"+t+"/explore/"}},{key:"createDsLinkFull",value:function(e,t){return'<a href="'+this.createDsLink2(e,t)+'" target="_blank">'+e+"."+t+"</a>"}},{key:"onLoad",value:function(e){e.fitView()}},{key:"render",value:function(){var e=this;this.props.deets.name!=this.state.last_ds&&(this.state.last_ds=this.props.deets.name,this.update("elements",this.props.deets));var t=this.props.deets.schema.columns.map((function(t){return l.a.createElement("tr",{onClick:function(){return e.openColumn(t)}},l.a.createElement("td",null,t.name),l.a.createElement("td",null,t.type),l.a.createElement("td",null,t.comment))}));return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{size:"lg",show:this.state.modalDialog,onHide:this.closeColumn,animation:!1},l.a.createElement(y.a.Header,{closeButton:!0},l.a.createElement(y.a.Title,null,this.state.selectedCol.name)),l.a.createElement(y.a.Body,null,l.a.createElement(m.a,null,l.a.createElement(h.a,null,l.a.createElement("div",{style:{height:300}},l.a.createElement(C.c,{onLoad:this.onLoad,elements:this.state.col_elements,nodeTypes:this.nodeTypes},l.a.createElement(C.a,{showInteractive:"false"})))),l.a.createElement(h.a,null,l.a.createElement(w.a,{style:{paddingTop:"15px"}},l.a.createElement(w.a.Group,{className:"mb-3"},l.a.createElement(w.a.Label,null,"Description"),l.a.createElement(w.a.Control,{type:"text",defaultValue:this.state.selectedCol.comment,onChange:function(t){return e.state.selectedCol.comment=t.target.value}}),l.a.createElement(w.a.Text,{className:"text-muted"},"Will be saved to the DSS Column name")))))),l.a.createElement(y.a.Footer,null,l.a.createElement(b.a,{variant:"secondary",onClick:function(){return e.saveColLineage()}},"Save all Lineage"),l.a.createElement(b.a,{variant:"primary",onClick:function(){return e.saveCol()}},"Save"))),l.a.createElement(m.a,{style:{paddingTop:"20px"}},l.a.createElement(h.a,null,l.a.createElement("h2",null,l.a.createElement("a",{href:this.createDsLink(this.props.deets),target:"_blank"},this.props.deets.name," (",this.props.deets.projectKey,")"))),l.a.createElement(h.a,null,l.a.createElement("h4",null,l.a.createElement("b",null,"Type:")," ",this.props.deets.type)),l.a.createElement(h.a,null,l.a.createElement("h4",null,l.a.createElement("b",null,"Last Modified:")," ",this.props.deets.versionTag.lastModifiedBy.login," @ ",this.props.deets.versionTag.lastModifiedOn)),l.a.createElement(h.a,null,l.a.createElement("h4",null,l.a.createElement("b",null,"Short Desc:")," ",this.props.deets.shortDesc)),l.a.createElement(h.a,null,l.a.createElement(_.a,{show:this.state.showA,delay:3e3,autohide:!0,animation:!1},l.a.createElement(_.a.Header,null,l.a.createElement("img",{src:"holder.js/20x20?text=%20",className:"rounded me-2",alt:""}),l.a.createElement("strong",{className:"me-auto"},"Bootstrap"),l.a.createElement("small",null,"11 mins ago")),l.a.createElement(_.a.Body,null,"Woohoo, you're reading this text in a Toast!"))),l.a.createElement(h.a,{style:{paddingTop:"20px"}},l.a.createElement(E.a,{defaultActiveKey:"lineage",id:"uncontrolled-tab-example",className:"mb-3"},l.a.createElement(v.a,{eventKey:"lineage",title:"Lineage"},l.a.createElement(h.a,null,l.a.createElement("div",{style:{height:300}},this.state.elements&&l.a.createElement(C.c,{onLoad:this.onLoad,elements:this.state.elements,nodeTypes:this.nodeTypes},l.a.createElement(C.a,{showInteractive:"false"}))))),l.a.createElement(v.a,{eventKey:"columns",title:"Columns",def:!0},l.a.createElement(g.a,{striped:!0,bordered:!0,hover:!0},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Name"),l.a.createElement("th",null,"Type"),l.a.createElement("th",null,"Description"))),l.a.createElement("tbody",null,t)))))))}}]),a}(n.Component),D=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleClick=function(){console.log("The link was clicked."),window.$.getJSON(window.getWebAppBackendUrl("initialize"),(function(e){var t=window.$("<pre />").text("Backend reply: "+JSON.stringify(e));window.$("body").append(t)}))},n.findDataset=function(e,t){var a=t.split(".")[0],n=t.split(".")[1],l=e[a];return console.log(l),l.datasets.find((function(e){return e.name===n}))},n.refreshData=function(){fetch(window.getWebAppBackendUrl("get-projects")).then((function(e){return e.json()})).then((function(e){var t=[];Object.keys(e).forEach((function(a){for(var n=0;n<e[a].datasets.length;n++){var l=e[a].datasets[n];t[t.length]={id:a+"."+l.name,label:l.name+" ("+a+")"}}})),n.setState({isLoaded:!0,project_list:t,full_tree:e})}))},n.state={rendered:!1,dataiku:void 0,isLoaded:!1,project_list:[],full_ds_name:"",full_tree:{},selectedDataset:null},n.project_list=[],n.handleClick=n.handleClick.bind(Object(c.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.$(document).ready((function(){e.setState({dataiku:window.dataiku}),e.setState({rendered:!0}),f.on("dataRefresh",(function(t){return e.refreshData()})),e.refreshData()}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.isLoaded,n=t.project_list,o=t.full_tree,s=(t.showDetail,t.selectedDataset),r=t.full_ds_name,i=l.a.createRef();return a?null==s?l.a.createElement(m.a,{style:{paddingTop:"20px"}},l.a.createElement(h.a,null,l.a.createElement(p.a,{ref:i,placeholder:"Search for Dataset",onChange:function(t){t.length>0&&(e.setState({selectedDataset:e.findDataset(o,t[0].id),full_ds_name:t[0].id}),i.current.clear())},options:n}))):l.a.createElement(m.a,{style:{paddingTop:"20px"}},l.a.createElement(h.a,null,l.a.createElement(p.a,{ref:i,placeholder:"Search for Dataset",onChange:function(t){t.length>0&&(e.setState({selectedDataset:e.findDataset(o,t[0].id),full_ds_name:t[0].id}),i.current.clear())},options:n})),l.a.createElement(h.a,null,l.a.createElement(j,{deets:s,full_ds_name:r}))):l.a.createElement("div",null,"Loading...")}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(D,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,a){e.exports=a(134)}},[[98,1,2]]]);
//# sourceMappingURL=main.039dfd2b.chunk.js.map